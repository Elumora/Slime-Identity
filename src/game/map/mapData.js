export const mapData = {
    gridWidth: 6,
    gridHeight: 50,

    backgroundTiles: [
        // 0, 1, 2, 3, 4, 5
        ['waterClean', 'tallGrass', 'grassMiddle', 'tallGrass', 'waterClean', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['tallGrass', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['grassMiddle', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'waterClean'],
        ['waterClean', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddleInner', 'grassMiddle'],
        ['waterClean', 'tallGrass', 'grassMiddle', 'tallGrass', 'waterClean', 'grassMiddle']
    ],

    path: [
        { x: 5, y: 49, tile: 'start' },
        { x: 4, y: 49, tile: 'straightLeft' },
        { x: 3, y: 49, tile: 'straightLeft' },
        { x: 2, y: 49, tile: 'turnRight' },
        { x: 2, y: 48, tile: 'straightRight' },
        { x: 2, y: 47, tile: 'straightRight' },
        { x: 2, y: 46, tile: 'straightRight' },
        { x: 2, y: 45, tile: 'turnLeftToRight' },
        { x: 3, y: 45, tile: 'straightLeft' },
        { x: 4, y: 45, tile: 'turnLeftToUp' },
        { x: 4, y: 44, tile: 'straightRight' },
        { x: 4, y: 43, tile: 'straightRight' },
        { x: 4, y: 42, tile: 'turnLeft' },
        { x: 3, y: 42, tile: 'straightLeft' },
        { x: 2, y: 42, tile: 'straightLeft' },
        { x: 1, y: 42, tile: 'straightLeft' },
        { x: 0, y: 42, tile: 'turnRight' },
        { x: 0, y: 41, tile: 'straightRight' },
        { x: 0, y: 40, tile: 'straightRight' },
        { x: 0, y: 39, tile: 'straightRight' },
        { x: 0, y: 38, tile: 'straightRight' },
        { x: 0, y: 37, tile: 'straightRight' },
        { x: 0, y: 36, tile: 'turnLeftToRight' },
        { x: 1, y: 36, tile: 'straightLeft' },
        { x: 2, y: 36, tile: 'straightLeft' },
        { x: 3, y: 36, tile: 'straightLeft' },
        { x: 4, y: 36, tile: 'turnLeftToUp' },
        { x: 4, y: 35, tile: 'straightRight' },
        { x: 4, y: 34, tile: 'straightRight' },
        { x: 4, y: 33, tile: 'turnLeft' },
        { x: 3, y: 33, tile: 'straightLeft' },
        { x: 2, y: 33, tile: 'straightLeft' },
        { x: 1, y: 33, tile: 'turnRight' },
        { x: 1, y: 32, tile: 'straightRight' },
        { x: 1, y: 31, tile: 'straightRight' },
        { x: 1, y: 30, tile: 'turnLeft' },
        { x: 0, y: 30, tile: 'turnRight' },
        { x: 0, y: 29, tile: 'straightRight' },
        { x: 0, y: 28, tile: 'straightRight' },
        { x: 0, y: 27, tile: 'straightRight' },
        { x: 0, y: 26, tile: 'straightRight' },
        { x: 0, y: 25, tile: 'straightRight' },
        { x: 0, y: 24, tile: 'turnLeftToRight' },
        { x: 1, y: 24, tile: 'straightLeft' },
        { x: 2, y: 24, tile: 'straightLeft' },
        { x: 3, y: 24, tile: 'straightLeft' },
        { x: 4, y: 24, tile: 'turnLeftToUp' },
        { x: 4, y: 23, tile: 'straightRight' },
        { x: 4, y: 22, tile: 'straightRight' },
        { x: 4, y: 21, tile: 'straightRight' },
        { x: 4, y: 20, tile: 'turnLeft' },
        { x: 3, y: 20, tile: 'straightLeft' },
        { x: 2, y: 20, tile: 'straightLeft' },
        { x: 1, y: 20, tile: 'straightLeft' },
        { x: 0, y: 20, tile: 'turnRight' },
        { x: 0, y: 19, tile: 'straightRight' },
        { x: 0, y: 18, tile: 'straightRight' },
        { x: 0, y: 17, tile: 'turnLeftToRight' },
        { x: 1, y: 17, tile: 'straightLeft' },
        { x: 2, y: 17, tile: 'straightLeft' },
        { x: 3, y: 17, tile: 'turnLeftToUp' },
        { x: 3, y: 16, tile: 'straightRight' },
        { x: 3, y: 15, tile: 'straightRight' },
        { x: 3, y: 14, tile: 'turnLeft' },
        { x: 2, y: 14, tile: 'straightLeft' },
        { x: 1, y: 14, tile: 'straightLeft' },
        { x: 0, y: 14, tile: 'turnRight' },
        { x: 0, y: 13, tile: 'straightRight' },
        { x: 0, y: 12, tile: 'straightRight' },
        { x: 0, y: 11, tile: 'straightRight' },
        { x: 0, y: 10, tile: 'turnLeftToRight' },
        { x: 1, y: 10, tile: 'straightLeft' },
        { x: 2, y: 10, tile: 'straightLeft' },
        { x: 3, y: 10, tile: 'straightLeft' },
        { x: 4, y: 10, tile: 'turnLeftToUp' },
        { x: 4, y: 9, tile: 'straightRight' },
        { x: 4, y: 8, tile: 'straightRight' },
        { x: 4, y: 7, tile: 'straightRight' },
        { x: 4, y: 6, tile: 'turnLeft' },
        { x: 3, y: 6, tile: 'straightLeft' },
        { x: 2, y: 6, tile: 'straightLeft' },
        { x: 1, y: 6, tile: 'straightLeft' },
        { x: 0, y: 6, tile: 'turnRight' },
        { x: 0, y: 5, tile: 'straightRight' },
        { x: 0, y: 4, tile: 'straightRight' },
        { x: 0, y: 3, tile: 'straightRight' },
        { x: 0, y: 2, tile: 'turnLeftToRight' },
        { x: 1, y: 2, tile: 'straightLeft' },
        { x: 2, y: 2, tile: 'straightLeft' },
        { x: 3, y: 2, tile: 'straightLeft' },
        { x: 4, y: 2, tile: 'turnLeftToUp' },
        { x: 4, y: 1, tile: 'straightRight' },
        { x: 4, y: 0, tile: 'straightRight' }
    ],

    tiles: {
        grass: ['grass1', 'grass2', 'grass3'],
        forest: ['forest1', 'forest2', 'forest3'],
        mountain: ['mountain1', 'mountain2']
    },

    objects: [
        { x: 1, y: 1, texture: 'arrowBoard' },
        { x: 3, y: 3, texture: 'stoneGrass' },
        { x: 5, y: 5, texture: 'stoneWater' },
        { x: 2, y: 7, texture: 'arrowBoard' },
        { x: 3, y: 9, texture: 'stoneGrass' },
        { x: 5, y: 8, texture: 'stoneWater' },
        { x: 5, y: 11, texture: 'stoneWater' },
        { x: 2, y: 13, texture: 'arrowBoard' },
        { x: 5, y: 14, texture: 'stoneWater' },
        { x: 2, y: 16, texture: 'stoneGrass' },
        { x: 1, y: 18, texture: 'arrowBoard' },
        { x: 5, y: 20, texture: 'stoneWater' },
        { x: 2, y: 23, texture: 'arrowBoard' },
        { x: 5, y: 26, texture: 'stoneWater' },
        { x: 4, y: 27, texture: 'stoneGrass' },
        { x: 3, y: 28, texture: 'stoneGrass' },
        { x: 5, y: 32, texture: 'stoneWater' },
        { x: 3, y: 35, texture: 'arrowBoard' },
        { x: 5, y: 38, texture: 'stoneWater' },
        { x: 2, y: 39, texture: 'arrowBoard' },
        { x: 4, y: 41, texture: 'stoneGrass' },
        { x: 3, y: 43, texture: 'stoneGrass' },
        { x: 5, y: 44, texture: 'stoneWater' },
        { x: 2, y: 47, texture: 'arrowBoard' },
        { x: 4, y: 48, texture: 'stoneGrass' },
        { x: 3, y: 49, texture: 'coin' }
    ],

    monsters: [],
    coins: [],
    chests: []
};

function generateRandomMonsters(path) {
    const enemies = [
        'plent', 'archer', 'black_werewolf', 'fighter', 'fire_spirit',
        'karasu_tengu', 'kitsune', 'red_werewolf', 'samurai', 'shinobi',
        'skeleton', 'swordsman', 'white_werewolf', 'wizard', 'yamabushi_tengu'
    ];
    
    const monsters = [];
    const pathLength = path.length;
    
    for (let i = 5; i < pathLength; i += Math.floor(Math.random() * 3) + 3) {
        const pos = path[i];
        const progress = i / pathLength;
        const numEnemies = progress > 0.5 ? (Math.random() > 0.5 ? 2 : 1) : 1;
        
        const enemyList = [];
        for (let j = 0; j < numEnemies; j++) {
            const enemyType = enemies[Math.floor(Math.random() * enemies.length)];
            const baseHealth = 15 + Math.floor(progress * 40);
            const baseAttack = 5 + Math.floor(progress * 8);
            
            enemyList.push({
                sprite: enemyType,
                health: baseHealth + Math.floor(Math.random() * 10),
                attack: baseAttack + Math.floor(Math.random() * 3)
            });
        }
        
        monsters.push({
            x: pos.x,
            y: pos.y,
            texture: enemyList[0].sprite,
            enemies: enemyList
        });
    }
    
    return monsters;
}

function generateRandomCoins(path, objects) {
    const coins = [];
    const pathLength = path.length;
    const existingCoins = objects.filter(obj => obj.texture === 'coin');
    
    for (let i = 3; i < pathLength; i += Math.floor(Math.random() * 5) + 4) {
        const pos = path[i];
        coins.push({ x: pos.x, y: pos.y });
    }
    
    existingCoins.forEach(coin => {
        coins.push({ x: coin.x, y: coin.y });
    });
    
    return coins;
}

function generateRandomChests(path) {
    const chests = [];
    const pathLength = path.length;
    
    for (let i = 10; i < pathLength; i += Math.floor(Math.random() * 15) + 15) {
        const pos = path[i];
        chests.push({ x: pos.x, y: pos.y });
    }
    
    return chests;
}

export function generateMap() {
    const monsters = generateRandomMonsters(mapData.path);
    const coins = generateRandomCoins(mapData.path, mapData.objects);
    const chests = generateRandomChests(mapData.path);
    
    const generatedMap = {
        monsters,
        coins,
        chests,
        timestamp: Date.now()
    };
    
    localStorage.setItem('generatedMap', JSON.stringify(generatedMap));
    return generatedMap;
}

export function loadMap() {
    const saved = localStorage.getItem('generatedMap');
    if (saved) {
        return JSON.parse(saved);
    }
    return generateMap();
}

const loadedMap = loadMap();
mapData.monsters = loadedMap.monsters;
mapData.coins = loadedMap.coins;
mapData.chests = loadedMap.chests || [];
